<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Input_CA</title>

    <link rel="stylesheet" href="../static/css/bootstrap.min.css">
    <style>
        .dropdown-container {
            width: 100%;
            margin-bottom: 10px;
            text-align: left;
        }
        .input-container {
            width: 100%;
            margin-bottom: 10px;
            text-align: left;
        }
    </style>
</head>

    <body class="bg-light container-flow">
    
        <h1 class="m-4">Input Changes</h1>
       
    
    
        <div class="container-fluid m-4"> 
          <div class="row">
            <div class="col-md-6 ml-5">
            <div id="Specification">
                <div class="input-container">
                    <label for="changeName">Change Name:</label>
                    <input type="text" id="changeName" name="changeName">
                </div>
                <div class="input-container">
                    <label for="changeId">Change ID:</label>
                    <input type="text" id="changeId" name="changeId">
                </div>
                <div class="input-container">
                    <label for="changeDescription">Change description:</label>
                    <input type="text" id="changeDescription" name="changeDescription">
                </div>
                <div class="input-container">
                    <label for="responsibility">Responsibility:</label>
                    <input type="text" id="responsibility" name="responsibility">
                </div>
                <div class="input-container">
                    <label for="timeframe">Timeframe:</label>
                    <input type="datetime-local" id="timeframe" name="timeframe">
                </div>
                <div class="input-container">
                    <label for="changeCause">Change cause:</label>
                    <input type="text" id="changeCause" name="changeCause">
                </div>
                <div class="input-container">
                    <label for="localization">Localization:</label>
                    <input type="text" id="localization" name="localization">
                </div>
                <div class="input-container">
                    <label for="departments">Departments:</label>
                    <input type="text" id="departments" name="departments">
                </div>
            </div>
    
            <!-- Coordination -->
            <div id="Coordination">
                <div class="input-container">
                    <label for="changeStatus">Change Status:</label>
                    <input type="text" id="changeStatus" name="changeStatus">
                </div>
                <div class="input-container">
                    <label for="timeOfOccurrence">Time of occurrence:</label>
                    <input type="datetime-local" id="timeOfOccurrence" name="timeOfOccurrence">
                </div>
                <div class="input-container">
                    <label for="lessonsLearned">Lessons learned:</label>
                    <input type="text" id="lessonsLearned" name="lessonsLearned">
                </div>
            </div>
            </div>
    
            <!-- Right panel -->
           <div class="col-md-6">
            <div class="dropdown-container" id="ImpactOnInternal">
                    <label for="ImpactOnInternal">Impact on internal</label>
            </div>
    
            <div class="dropdown-container" id="ImpactOnExternal">
                    <label for="ImpactOnInternal">Impact on external</label>
            </div>
    
            <div class="dropdown-container" id="Efforts">
                    <label for="Efforts">Efforts</label>
            </div>
    
            <div class="dropdown-container" id="Costs">
                    <label for="Costs">Costs</label>
            </div>
    
            <div class="dropdown-container" id="AvailableDataInformation">
                    <label for="AvailableDataInformation">Available data/information</label>
            </div>
    
            <div class="dropdown-container" id="DependencyLevel">
                    <label for="DependencyLevel">Dependency level</label>
            </div>
    
            <div class="dropdown-container" id="ChangePropagation">
                    <label for="ChangePropagation">Change propagation</label>
            </div>
    
            <div class="dropdown-container" id="ChangeReoccurrence">
                    <label for="ChangeReoccurrence">Change reoccurrence</label>
            </div>
    
            <div class="dropdown-container" id="Complexity">
                    <label for="Complexity">Complexity</label>
            </div>
    
            <div class="dropdown-container" id="Challenges">
                    <label for="Challenges">Challenges</label>
            </div>
    
            <div class="dropdown-container" id="Duration">
                    <label for="Duration">Duration</label>
            </div>
    
            <div class="dropdown-container" id="Relevance">
                    <label for="Relevance">Relevance</label>
            </div>
    
            <div class="dropdown-container" id="Urgency">
                    <label for="Urgency">Urgency</label>
            </div>
        
           </div>
          <div>           
            <button class="left-button btn btn-success" id="save" onclick="saveData()">Save</button>
            <button class="right-button btn btn-primary"id="finish" onclick="window.close();">Finish</button>
         </div>

          </div>
        </div>
    </body> 

    <script src="../static/js/bootstrap.bundle.min.js"></script>
    <script>
       /* Creat drop down with nummbers 0-9 */
        window.onload = function() {
            createDropdowns();
        };

        function createDropdowns() {
            const dropdownPlaces = document.querySelectorAll('.dropdown-container');

            // for each container
            dropdownPlaces.forEach(function(container) {
                const select = document.createElement('select');
                select.id = container.id ;

                for (let i = 0; i <= 9; i++) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = i;
                    select.appendChild(option);
                }
                container.prepend(select);
            });
        }


        /* save data */
        function saveData() {
            const data = {
                changeName: document.getElementById('changeName').value.toString(),
                changeId: document.getElementById('changeId').value.toString(),
                changeDescription: document.getElementById('changeDescription').value.toString(),
                responsibility: document.getElementById('responsibility').value.toString(),
                timeframe: document.getElementById('timeframe').value.toString(),
                changeCause: document.getElementById('changeCause').value.toString(),
                localization: document.getElementById('localization').value.toString(),
                departments: document.getElementById('departments').value.toString(),
                changeStatus: document.getElementById('changeStatus').value.toString(),
                timeOfOccurrence: document.getElementById('timeOfOccurrence').value.toString(),
                lessonsLearned: document.getElementById('lessonsLearned').value.toString(),
                ImpactOnInternal: document.getElementById('ImpactOnInternal').querySelector('select').value,
                ImpactOnExternal: document.getElementById('ImpactOnExternal').querySelector('select').value,
                Efforts: document.getElementById('Efforts').querySelector('select').value,
                Costs: document.getElementById('Costs').querySelector('select').value,
                AvailableDataInformation: document.getElementById('AvailableDataInformation').querySelector('select').value,
                DependencyLevel: document.getElementById('DependencyLevel').querySelector('select').value,
                ChangePropagation: document.getElementById('ChangePropagation').querySelector('select').value,
                ChangeReoccurrence: document.getElementById('ChangeReoccurrence').querySelector('select').value,
                Complexity: document.getElementById('Complexity').querySelector('select').value,
                Challenges: document.getElementById('Challenges').querySelector('select').value,
                Duration: document.getElementById('Duration').querySelector('select').value,
                Relevance: document.getElementById('Relevance').querySelector('select').value,
                Urgency: document.getElementById('Urgency').querySelector('select').value
            };

            fetch('/save_change_attribute', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    alert('Data saved successfully.');
                    setTimeout(() => {
                        location.reload();
                    }, 100); // 0.1s delay
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => console.error('Error:', error));
        }

        window.onload = function() {
            createDropdowns();
        };
    </script>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        fetch('/get_change_attribute')
            .then(response => response.json())
            .then(data => {
                console.log('Data received:', data);  // 输出接收到的数据进行调试
                const tableBody = document.querySelector('#dataTable tbody');
                data.forEach(row => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${row.changeName}</td>
                        <td>${row.changeId}</td>
                        <td><button onclick="deleteRow('${row.changeId}')">Delete</button></td>
                    `;
                    tableBody.appendChild(tr);
                });
            })
            .catch(error => {
                console.error('Error fetching data:', error);
            });
    });

function deleteRow(changeId) {
    fetch('/delete_change_attribute', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ changeId: changeId.toString() })
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'success') {
            alert('Row deleted successfully.');
            location.reload();  // 删除成功后刷新页面
        } else {
            alert('Error deleting row: ' + data.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
    });
}
</script>
</body>
</html>



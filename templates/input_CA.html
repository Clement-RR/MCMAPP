<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Input_CA</title>
    <script>
        // 在页面加载完成后运行此函数
        window.onload = function() {
            createDropdowns();
        };

        // 此函数负责创建所有的下拉菜单
        function createDropdowns() {
            const dropdownPlaces = document.querySelectorAll('.dropdown-container'); // 选择所有需要下拉菜单的容器

            // 对每个容器进行操作
            dropdownPlaces.forEach(function(container) {
                const select = document.createElement('select'); // 创建select元素
                select.id = container.id ; // 为select元素创建一个基于容器id的唯一id
                // 添加选项1到9
                for (let i = 0; i <= 9; i++) {
                    const option = document.createElement('option'); // 创建option元素
                    option.value = i;
                    option.textContent = i;
                    select.appendChild(option); // 将option添加到select中
                }
                container.prepend(select); // 将select添加到当前容器中
            });
        }

        function saveData() {
            const data = {
                changeName: document.getElementById('changeName').value.toString(),
                changeId: document.getElementById('changeId').value.toString(),
                changeDescription: document.getElementById('changeDescription').value.toString(),
                responsibility: document.getElementById('responsibility').value.toString(),
                timeframe: document.getElementById('timeframe').value.toString(),
                changeCause: document.getElementById('changeCause').value.toString(),
                localization: document.getElementById('localization').value.toString(),
                departments: document.getElementById('departments').value.toString(),
                changeStatus: document.getElementById('changeStatus').value.toString(),
                timeOfOccurrence: document.getElementById('timeOfOccurrence').value.toString(),
                lessonsLearned: document.getElementById('lessonsLearned').value.toString(),
                ImpactOnInternal: document.getElementById('ImpactOnInternal').querySelector('select').value,
                ImpactOnExternal: document.getElementById('ImpactOnExternal').querySelector('select').value,
                Efforts: document.getElementById('Efforts').querySelector('select').value,
                Costs: document.getElementById('Costs').querySelector('select').value,
                AvailableDataInformation: document.getElementById('AvailableDataInformation').querySelector('select').value,
                DependencyLevel: document.getElementById('DependencyLevel').querySelector('select').value,
                ChangePropagation: document.getElementById('ChangePropagation').querySelector('select').value,
                ChangeReoccurrence: document.getElementById('ChangeReoccurrence').querySelector('select').value,
                Complexity: document.getElementById('Complexity').querySelector('select').value,
                Challenges: document.getElementById('Challenges').querySelector('select').value,
                Duration: document.getElementById('Duration').querySelector('select').value,
                Relevance: document.getElementById('Relevance').querySelector('select').value,
                Urgency: document.getElementById('Urgency').querySelector('select').value
            };

            fetch('/save_change_attribute', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    alert('Data saved successfully.');
                    setTimeout(() => {
                        location.reload();
                    }, 100); // 0.1秒延迟后刷新页面
                } else {
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => console.error('Error:', error));
        }

        window.onload = function() {
            createDropdowns();
        };
    </script>

    <style>
        body {
            display: flex; /* 定义为 flex 容器 */
            height: 100vh;
            margin: 0; /* 移除默认的 margin */
            background-color: #f0f0f0;
        }
        #leftPanel {
            width: 50%; /* 左侧面板占据50%的宽度 */
            height: 100%; /* 全高 */
            display: flex;
            flex-direction: column; /* 子元素垂直排列 */
        }
        #Specification, #Coordination {
            flex: 1; /* 平分 leftPanel */
            display: flex;
            flex-direction: column; /* 子元素垂直排列 */
            justify-content: space-around; /* 在区域内均匀分布 */
            padding: 20px; /* 留出内边距 */
        }
        #rightPanel {
            width: 50%; /* 右侧面板也占据50%的宽度 */
            height: 100%; /* 全高 */
            display: flex;
            flex-direction: column; /* 子元素垂直排列 */
            justify-content: space-around; /* 子元素均匀分布 */
            align-items: flex-start;  /* 子元素左端对齐 */
            padding: 40px 20px; /* 留出上下和左右内边距 */
        }
        .input-container {
            margin-bottom: 15px;
            text-align: left;
        }
        .dropdown-container {
            width: 100%;
            margin-bottom: 10px;
            text-align: left;
        }
    </style>
</head>
<body>
    <!-- Left panel -->
    <div id="leftPanel">
        <div id="table">
            <table id="dataTable">
                <thead>
                    <tr>
                        <th>Change Name</th>
                        <th>Change ID</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
        <!-- Specification -->
        <div id="Specification">
            <div class="input-container">
                <label for="changeName">Change Name:</label>
                <input type="text" id="changeName" name="changeName">
            </div>
            <div class="input-container">
                <label for="changeId">Change ID:</label>
                <input type="text" id="changeId" name="changeId">
            </div>
            <div class="input-container">
                <label for="changeDescription">Change description:</label>
                <input type="text" id="changeDescription" name="changeDescription">
            </div>
            <div class="input-container">
                <label for="responsibility">Responsibility:</label>
                <input type="text" id="responsibility" name="responsibility">
            </div>
            <div class="input-container">
                <label for="timeframe">Timeframe:</label>
                <input type="datetime-local" id="timeframe" name="timeframe">
            </div>
            <div class="input-container">
                <label for="changeCause">Change cause:</label>
                <input type="text" id="changeCause" name="changeCause">
            </div>
            <div class="input-container">
                <label for="localization">Localization:</label>
                <input type="text" id="localization" name="localization">
            </div>
            <div class="input-container">
                <label for="departments">Departments:</label>
                <input type="text" id="departments" name="departments">
            </div>
        </div>

        <!-- Coordination -->
        <div id="Coordination">
            <div class="input-container">
                <label for="changeStatus">Change Status:</label>
                <input type="text" id="changeStatus" name="changeStatus">
            </div>
            <div class="input-container">
                <label for="timeOfOccurrence">Time of occurrence:</label>
                <input type="datetime-local" id="timeOfOccurrence" name="timeOfOccurrence">
            </div>
            <div class="input-container">
                <label for="lessonsLearned">Lessons learned:</label>
                <input type="text" id="lessonsLearned" name="lessonsLearned">
            </div>
        </div>
    </div>

    <!-- Right panel -->
    <div id="rightPanel">
        <div class="dropdown-container" id="ImpactOnInternal">
                <label for="ImpactOnInternal">Impact on internal</label>
        </div>

        <div class="dropdown-container" id="ImpactOnExternal">
                <label for="ImpactOnInternal">Impact on external</label>
        </div>

        <div class="dropdown-container" id="Efforts">
                <label for="Efforts">Efforts</label>
        </div>

        <div class="dropdown-container" id="Costs">
                <label for="Costs">Costs</label>
        </div>

        <div class="dropdown-container" id="AvailableDataInformation">
                <label for="AvailableDataInformation">Available data/information</label>
        </div>

        <div class="dropdown-container" id="DependencyLevel">
                <label for="DependencyLevel">Dependency level</label>
        </div>

        <div class="dropdown-container" id="ChangePropagation">
                <label for="ChangePropagation">Change propagation</label>
        </div>

        <div class="dropdown-container" id="ChangeReoccurrence">
                <label for="ChangeReoccurrence">Change reoccurrence</label>
        </div>

        <div class="dropdown-container" id="Complexity">
                <label for="Complexity">Complexity</label>
        </div>

        <div class="dropdown-container" id="Challenges">
                <label for="Challenges">Challenges</label>
        </div>

        <div class="dropdown-container" id="Duration">
                <label for="Duration">Duration</label>
        </div>

        <div class="dropdown-container" id="Relevance">
                <label for="Relevance">Relevance</label>
        </div>

        <div class="dropdown-container" id="Urgency">
                <label for="Urgency">Urgency</label>
        </div>

        <button id="save" onclick="saveData()">Save</button>
        <button id="finish" onclick="window.close();">Finish</button>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        fetch('/get_change_attribute')
            .then(response => response.json())
            .then(data => {
                console.log('Data received:', data);  // 输出接收到的数据进行调试
                const tableBody = document.querySelector('#dataTable tbody');
                data.forEach(row => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${row.changeName}</td>
                        <td>${row.changeId}</td>
                        <td><button onclick="deleteRow('${row.changeId}')">Delete</button></td>
                    `;
                    tableBody.appendChild(tr);
                });
            })
            .catch(error => {
                console.error('Error fetching data:', error);
            });
    });

function deleteRow(changeId) {
    fetch('/delete_change_attribute', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ changeId: changeId.toString() })
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'success') {
            alert('Row deleted successfully.');
            location.reload();  // 删除成功后刷新页面
        } else {
            alert('Error deleting row: ' + data.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
    });
}
</script>
</body>
</html>